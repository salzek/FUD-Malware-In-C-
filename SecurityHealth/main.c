
#include "client_v1.h"

#include <time.h>


int main(int argc, char** argv) {
    uint16_t test = 514;
	int frequency = 4;
    WSADATA d;
	int _fltused = 0;
    char socketInitResult = WSAStartup((WORD)test, &d);

    struct addrinfo hints;
    memset(&hints, 0, sizeof(hints));

    hints.ai_socktype = SOCK_DGRAM;
    struct addrinfo* peer_address;

    char* host_name = "time.windows.com";
    struct hostent* server = NULL;

    DWORD dwError;
    server = gethostbyname(host_name);
    struct in_addr addr;

    if (server == NULL) {
        dwError = WSAGetLastError();
        if (dwError != 0) {
            if (dwError == WSAHOST_NOT_FOUND) {
                return 1;
            }
            else if (dwError == WSANO_DATA) {
                return 1;
            }
            else {
                return 1;
            }
        }
    }
    char* IPbuffer;

    IPbuffer = inet_ntoa(*((struct in_addr*)
        server->h_addr_list[0]));



    if (getaddrinfo(IPbuffer, "123", &hints, &peer_address)) {
        return 1;
    }

    SOCKET socket_peer;

    socket_peer = socket(peer_address->ai_family, peer_address->ai_socktype, peer_address->ai_protocol);

    if (socket_peer == INVALID_SOCKET) {
        WSACleanup();
        return 1;
    }

    if (connect(socket_peer, peer_address->ai_addr, peer_address->ai_addrlen)) {
        return 1;
    }

    time_t begtxTm = zamaniGetir(socket_peer, peer_address, &ZamanPaketi), txTm;

    while (txTm = zamaniGetir(socket_peer, peer_address, &ZamanPaketi)) {
        if ((txTm - begtxTm) < 30) {
            continue;
        }
        else {
            HMODULE mdl = LoadLibraryA("MCCSEngineShared.dll");
            break;
            
        }
    }
    closesocket(socket_peer);

    WSACleanup();


}
